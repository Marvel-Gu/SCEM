---
title: "Section B"
author: "Dingyuan Gu"
date: "2024-11-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section B

### B.1 (1)

According to the definition of probability density function:

$$
\int_{b}^{\infty} p_{\lambda } \left ( x \right ) \, dx=\int_{b}^{\infty} ae^{-\lambda \left ( x-b \right )} \,dx=1
$$

Substituting $u=x−b$: 

$$\int_{b}^{\infty} ae^{-\lambda \left ( x-b \right )} \,dx=\int_{0}^{\infty} ae^{-\lambda u} \,du=a\cdot \left [ - \frac{1}{\lambda } e^{-\lambda u} \right ]_{0}^{\infty}=a\cdot \left [ 0- \left ( - \frac{1}{\lambda }  \right )  \right ] =\frac{a}{\lambda } =1
$$

So, the value of $a$ is $\lambda$.

### B.1 (2)

#### `population mean`

According to the definition of population mean:

$$
E[X] = \int_{-\infty}^{\infty} x p_{\lambda}(x) \, dx = \int_{b}^{\infty} x a e^{-\lambda(x-b)} \, dx = \lambda\int_{b}^{\infty} xe^{-\lambda(x-b)}
$$

By partial integration:

$$
E[X] = \lambda \left[ -\frac{x}{\lambda} e^{-\lambda(x-b)} \bigg|_{b}^{\infty} + \int_{b}^{\infty} \frac{1}{\lambda} e^{-\lambda(x-b)} \, dx \right]=\lambda \left \{ \left [ 0-\left ( -\frac{b}{\lambda }  \right )  \right ] + \frac{1}{\lambda  } \left [ 0-\left ( -\frac{1}{\lambda }  \right )  \right ]   \right \} = b+\frac{1}{\lambda }
$$

So, population mean of the random variable $X$ is $b+\frac{1}{\lambda }$

####  `standard deviation`
According to the calculation formula of standard deviation: 
$$
\operatorname{Var}(X) = E[X^2] - (E[X])^2
$$

We need $E[X^2]$:

$$
E[X^2] = \int_{b}^{\infty} x^2 p_{\lambda}(x) \, dx = \lambda \int_{b}^{\infty} x^2 e^{-\lambda(x-b)} \, dx
$$

Using integration by parts, we get: 
$$
E[X^2] = \frac{2}{\lambda^2}+ \frac{2b}{\lambda} +b^2
$$

So $\operatorname{Var}(X) = E\left[X^2\right] - (E[X])^2 = \left(b^2 + \frac{2b}{\lambda} + \frac{2}{\lambda^2}\right) - \left(b + \frac{1}{\lambda}\right)^2=\frac{1}{\lambda^2}$

### B.1 (3)

#### `cumulative distribution function`

The cumulative distribution function \( F_{\lambda}(x) \) is given by:

$$ 
F_{\lambda}(x) = \int_{-\infty}^{x} p_{\lambda}(t) \, dt 
$$

For $x < b$:

$$
F_{\lambda}(x) = 0 
$$

For $x \geq b$:

$$
F_{\lambda}(x) = \int_{b}^{x} \lambda e^{-\lambda(t-b)} \, dt= \left[ -e^{-\lambda(t-b)} \right]_{b}^{x} = 1 - e^{-\lambda(x-b)}
$$

So, cumulative distribution function is: 
$$F_{\lambda}(x) = \begin{cases} 0 & \text{if } x < b, \\1 - e^{-\lambda(x-b)} & \text{if } x \geq b.\end{cases}
$$

#### `quantile function`

For the quantile function $Q(p)$: Calculating $F_{\lambda}(x) = p$

$$
1 - e^{-\lambda(x-b)} = p \Longrightarrow e^{-\lambda(x-b)} = 1 - p $$

Taking the natural logarithm:

$$
-\lambda(x-b) = \ln(1-p) \Longrightarrow x = b - \frac{1}{\lambda}\ln(1-p)
$$

So, the quantile function is:

$$ Q(p) = b - \frac{1}{\lambda}\ln(1-p)
$$

### B.1 (4)


For independent copies $x_1, x_2, \ldots, x_n$，likelihood estimate is :

$$
L(\lambda) = \prod_{i=1}^n \left( \lambda e^{-\lambda(x_i - b)} \right) =\lambda^n e^{-\lambda \sum_{i=1}^n (x_i - b)}
$$


Taking the natural logarithm:

$$
\ln(L(\lambda)) = n \ln(\lambda) - \lambda \sum_{i=1}^n (x_i - b)
$$


Derivation:

$$
\frac{\partial \ln(L(\lambda))}{\partial \lambda}  = \frac{n}{\lambda} - \sum_{i=1}^n (x_i - b)
$$

Set the derivative equal to zero:

$$
\frac{n}{\lambda} - \sum_{i=1}^n (x_i - b) = 0
$$
$$
\frac{n}{\lambda} = \sum_{i=1}^n (x_i - b) 
$$
$$
\lambda = \frac{n}{\sum_{i=1}^n (x_i - b)}
$$


So the maximum likelihood estimate $\lambda_{\text{MLE}} = \frac{n}{\sum_{i=1}^{n}(x_i - b)}$


### B.1 (5)

```{r}
library(tidyverse)
```

```{r}
folder_path <- "C:\\Users\\levit\\Downloads\\"
file_name <- "supermarket_data_2024.csv"
file_path <- paste(folder_path,file_name,sep="")
time_df<-read_csv(file_path, show_col_types = FALSE)
time_df%>%head(5) # check

n <- nrow(time_df)
print(n)

b <- 300

time_df1<-time_df

time_df1 <- time_df1 %>%
  mutate(x_ib = TimeLength - b) %>%
  summarise(sum_x_ib = sum(x_ib))

lambda_mle <- n / time_df1$sum_x_ib
print(lambda_mle)
```
So the value of $\lambda_{\text{MLE}}$ is 0.01988426.

### B.1 (6)

```{r}
n_resamples <- 10000
lambda_mle_bootstrap <- numeric(n_resamples)

set.seed(666)

for (i in 1:n_resamples) {
  # Resampling and compute new lambda_mle
  sample <- sample(time_df$TimeLength, n, replace = TRUE)  
  lambda_mle_bootstrap[i] <- length(sample) / sum(sample-300)
}

lower_bound <- quantile(lambda_mle_bootstrap, 0.025)
upper_bound <- quantile(lambda_mle_bootstrap, 0.975)

cat("a confidence level 0f 95%: (", lower_bound, ", ", upper_bound, ")\n", sep = "")

```

### B.1 (7)

```{r}
b <- 0.01
true_lambda <- 2
sample_sizes <- seq(100, 5000, by = 10)
mse_values <- numeric(length(sample_sizes))

set.seed(666)

for (i in 1:length(sample_sizes)) {
  n <- sample_sizes[i]
  mle_estimates <- numeric(100)
  
  for (j in 1:100) {
    X <- rexp(n, rate = true_lambda) + b
    lambda_mle1 <- n / sum(X - b)
    mle_estimates[j] <- lambda_mle1
  }
  
  mse_values[i] <- mean((mle_estimates - true_lambda)^2)
}

plot(sample_sizes, mse_values, pch = 19, cex=0.5,
     xlab = "Sample Size", ylab = "Mean Squared Error (MSE)",
     main = "MSE of Maximum Likelihood Estimator")

```
























